<div class="mb-4">
    <h2 class="mb-1"><?= $lang->t('reports') ?></h2>
    <p class="text-muted mb-0"><?= $lang->t('reports_desc') ?></p>
</div>

<!-- Filters -->
<div class="card mb-5">
    <div class="card-body">
        <form method="GET" action="<?= $baseUrl ?>/reports" class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="form-label"><?= $lang->t('child') ?></label>
                <select name="child_id" class="form-select">
                    <option value=""><?= $lang->t('all') ?></option>
                    <?php foreach ($children as $c): ?>
                        <option value="<?= $c['id'] ?>" <?= ($filters['child_id'] ?? '') == $c['id'] ? 'selected' : '' ?>>
                            <?= htmlspecialchars($c['name']) ?>
                        </option>
                    <?php endforeach; ?>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label"><?= $lang->t('date_from') ?></label>
                <input type="date" name="date_from" class="form-control" value="<?= $filters['date_from'] ?? '' ?>">
            </div>
            <div class="col-md-3">
                <label class="form-label"><?= $lang->t('date_to') ?></label>
                <input type="date" name="date_to" class="form-control" value="<?= $filters['date_to'] ?? '' ?>">
            </div>
            <div class="col-md-3 d-flex gap-2">
                <button class="btn btn-primary flex-fill">
                    <i class="bi bi-funnel me-1"></i><?= $lang->t('filter') ?>
                </button>
                <a href="<?= $baseUrl ?>/reports/export?<?= http_build_query($filters) ?>" class="btn btn-outline-success flex-fill">
                    <i class="bi bi-download me-1"></i><?= $lang->t('export_csv') ?>
                </a>
            </div>
        </form>
    </div>
</div>

<!-- Summary Stats -->
<div class="row g-4 mb-5">
    <div class="col-md-3">
        <div class="stat-card green">
            <div class="stat-label"><?= $lang->t('total_earned') ?></div>
            <div class="stat-value">+<?= $summary['total_earned'] ?></div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card red">
            <div class="stat-label"><?= $lang->t('total_deducted') ?></div>
            <div class="stat-value"><?= $summary['total_deducted'] ?></div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card blue">
            <div class="stat-label"><?= $lang->t('net_points') ?></div>
            <div class="stat-value"><?= $summary['net'] >= 0 ? '+' : '' ?><?= $summary['net'] ?></div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card yellow">
            <div class="stat-label"><?= $lang->t('money_equivalent') ?></div>
            <div class="stat-value"><?= $currencySymbol ?><?= number_format($summary['net'] / max(1, $pointsPerLari), 2) ?></div>
        </div>
    </div>
</div>

<!-- Charts -->
<div class="row g-4 mb-5">
    <div class="col-lg-8">
        <div class="card h-100">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-graph-up me-2" style="color: var(--coral);"></i><?= $lang->t('points_over_time') ?></h6>
            </div>
            <div class="card-body">
                <canvas id="pointsOverTimeChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card h-100">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-pie-chart me-2" style="color: var(--lavender);"></i><?= $lang->t('points_by_category') ?></h6>
            </div>
            <div class="card-body d-flex align-items-center">
                <canvas id="pointsByCategoryChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h6 class="mb-0"><i class="bi bi-bar-chart me-2" style="color: var(--mint);"></i><?= $lang->t('child_comparison') ?></h6>
    </div>
    <div class="card-body">
        <canvas id="childComparisonChart"></canvas>
    </div>
</div>

<script type="application/json" id="chartData"><?= $chartData ?></script>
